<?php
//Start HVN

$date = new DateTime('23-03-2012');
$date_from = $date->getTimestamp();
$date = new DateTime('27-03-2012');
$date_to = $date->getTimestamp();

?>
	<form method="POST" action="<?php echo $_SERVER['PHP_SELF'];?>">
From:<INPUT TYPE = "Text" VALUE ="23-03-2012" NAME = "date_from">
To:<INPUT TYPE = "Text" VALUE ="27-03-2012" NAME = "date_to">
<INPUT type = "submit" value="Ok">
</form>

<?php

//$date_from = $_POST["date_from"];
//$date_to = $_POST["date_to"];
echo "<br>REPORT START HERE</br>";

//Chi tiet

$sql = "SELECT product_name FROM product";
$query = mysql_query($sql);
while($kq = mysql_fetch_array($query))
{
	//echo $kq["product_name"];
	$detail[$kq["product_name"]] = 0;

}

//Tong quat 
$user_id = $_SESSION['user_id'];
$sql = "SELECT create_date, product_name 
	FROM product, product_version, serial
	WHERE
	product.product_id = product_version.product_id AND
	product_version.version_id = serial.version_id AND
	user_id = '".$user_id."' AND
	create_date >= '".$date_from."' AND
	create_date <= '".$date_to."'
	ORDER BY create_date 
	";
$query=mysql_query($sql);
$date = -1;
$last_date = 0;
$count = 0;


echo "<table>";


while($row=mysql_fetch_array($query))
{
	$date =  date('d-m-Y',$row["create_date"]);
	if($date == $last_date)
	{
		$count++;
		$detail[$row["product_name"]]++;
	}
	else
	{
		echo "<tr><b><td>".$last_date."</td><td>TOTAL</td><td>".$count."</td></b></tr>";
		foreach($detail as $key => &$value)
		{
			if($value > 0)
			{
				echo "<tr><b><td>".$key."</td><td>".$value."</td></tr>";
				$value = 0;
			}
		}
		$last_date = $date;
		$count = 1;
		$detail[$row["product_name"]]++;
	}
	//echo $date." ".$row["product_name"]."<br>";

}

echo "<tr><b><td>".$last_date."</td><td>TOTAL</td><td>".$count."</td></b></tr>";
foreach($detail as $key => &$value)
{
	if($value > 0)
	{
		echo "<tr><b><td></td><td>".$key."</td><td>".$value."</td></tr>";
		$value = 0;
	}
}
echo "</table>";
//End HVN

?>
