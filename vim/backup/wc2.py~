#!/usr/bin/env python
import sys

class WordData():
	def __init__(self, word, line):
		self.counter = 1
		self.word = word
		self.line_numbers = [line]

	def __repr__(self):
		lines = " ".join(str(n) for n in self.line_numbers)
		return str(self.counter) + " " + self.word + " " + lines 

	def increase_counter(self):
		self.counter += 1

	def add_line_number(self, numb):
		if numb not in self.line_numbers:
			self.line_numbers.append(numb)

def count_words(filename):
	fin = open(filename, 'r')
	lines = fin.readlines()

	d = {}
	#count word and line
	for line in lines:
		#get line number
		line_number = lines.index(line) + 1
		for w in line.split():
			#Lower case
			lower = w.lower()
			#store counter, line numbers in a list in value of dict
			if lower in d:
				#first element is counter, others are line numbers
				d[lower].increase_counter()
				d[lower].add_line_number(line_number)
			else:
				d[lower] = WordData(lower, line_number)

	word_datas = d.values()
	#sort by desc frequency, then by asc word
	word_datas.sort(key=lambda wdata : (-wdata.counter, wdata.word))

	#print out
	for e in word_datas:
		print e

def main():
	if len(sys.argv) != 2:
		print 'Use: python wordcounter.py word.in'
		sys.exit(1)

	filename = sys.argv[1]
	count_words(filename)

if __name__ == '__main__':
	main()
