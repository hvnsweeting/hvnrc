<h1>Danh mục đội </h1>

<?php
require_once 'config.php';
startMySQLConnection();
?>

<form name="frmC" id="frmC" method="post" action="">
<input type="hidden" name="hdnUpdateId" />
<input type="hidden" name="hdnDeleteId" />
<input type="hidden" name="hdnAddCommand" value="0" />
<?php

// Handle Update
if (isset($_POST["hdnUpdateId"]) && $_POST["hdnUpdateId"] > 0) {
    $id = $_POST["hdnUpdateId"];
    $sql = "Update teams set `name` = '".$_POST["txtName_".$id]."' Where id=" . $id;
    mysql_query($sql);
}
// Handle Delete
if (isset($_POST["hdnDeleteId"]) && $_POST["hdnDeleteId"] > 0) {
    $id = $_POST["hdnDeleteId"];
    $sql = "Delete From `teams` Where id=" . $id;
    mysql_query($sql);
}
// Handle Add new:
if (isset($_POST["hdnAddCommand"]) && $_POST["hdnAddCommand"] > 0) {
    $name = $_POST["txtAddName"];
    $country = $_POST["country"];
    if ($name == null || $name == "") {
        echo "<font color='red'>Vui lòng nhập tên đội bóng</font>";
    } else {
        $sql = "Insert Into teams(name, countryId) Values('".$name."', $country)";
        mysql_query($sql);
    }
}

// List team by name
$filterByName = $_POST["txtFilterByName"];
$sql = "Select teams.id, teams.name, countries.name AS country
	From `teams`, `countries` 
        where countryId = countries.id " . 
            ($filterByName != null && $filterByName != "" ? " And teams.name Like '%".$filterByName."%'" : "") . " 
        Order By teams.name Asc";

//SELECT * FROM `teams`, `countries`
//WHERE countryId = countries.id
//echo $sql;
$result = mysql_query($sql);
?>
<table>
    <tr>
        <td>
            Lọc:
        </td>
        <td>
            <input type="text" name="txtFilterByName" value="<?php echo($filterByName); ?>" />
            <input type="submit" name="btnFilter" value="Lọc" />
        </td>
    </tr>
</table>

<table style="border: solid activecaption thin;">
    <tr style="background-color: activecaption;">
        <td><b>Id</b></td>
        <td><b>Tên đội</b></td>
        <td>Quốc gia</td>
    </tr>
    <tr style="background-color: #dcdcdc;">
	    <td></td>
        <td>
            Thêm đội: <input type="text" name="txtAddName" />
	</td>
	<td>
	    <select id="sltCountry" name="country" >
		    <?php
			$countrySql = "select id, name from `countries` order by name ASC";
			$countryResult = mysql_query($countrySql);
			while($row = mysql_fetch_array($countryResult))
			{
				$cId = $row['id'];
				$cName = $row['name'];
		   		echo ' <option value="'.$cId.'">'.$cName.'</option>';
			}
		    ?>
	    </select>
	</td>
	<td>

            <input type="button" name="btnAddNew" value="Thêm mới" 
                onclick="
                    frmC.hdnAddCommand.value='1'; 
                    frmC.submit();
                " 
                />
	</td>
    </tr>
    <?php
    $i = 0;
//    $count = mysql_affected_rows();
//    echo $count;
    while ($r=mysql_fetch_array($result)) {
        $cId = $r["id"];
        ?>
        <tr style="background-color: <?php echo($i % 2 == 0 ? "white" : "#f5f5f5"); ?>">
            <td><?php echo($r["id"]); ?></td>
            <td>
                <input type="text" 
                    name="txtName_<?php echo($cId); ?>" 
                    value="<?php echo($r["name"]); ?>"
                    style="border:none; width: 100%; background-color: inherit;"
                    />
            </td>
	    <td><?php echo($r["country"]);?> </td>
            <td nowrap="true">
                <input type="button" 
                    name="btnUpdate_<?php echo($cId); ?>"
                    value="Detail"
                    />
                <input type="button" 
                    name="btnUpdate_<?php echo($cId); ?>"
                    onclick="
                        frmC.hdnUpdateId.value='<?php echo($cId); ?>';
                        frmC.submit();
                    "
                    value="Edit"
                    />
                <input type="button" 
                    name="btnDelete_<?php echo $cId; ?>"
                    onclick="
                        if (confirm('Bạn chắc chắn muốn xóa?')) {
                            frmC.hdnDeleteId.value='<?php echo($cId); ?>';
                            frmC.submit();
                        }
                    "
                    value="Xóa"
                    />
            </td>
        </tr>
        <?php
        $i++;
    }
    ?>
</table>
</form>
