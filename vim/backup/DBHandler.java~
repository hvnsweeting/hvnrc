package com.familug.hvn;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;
import android.util.Log;

public class DBHandler extends SQLiteOpenHelper 
{
	public DBHandler(Context context) {
		super(context, DB_NAME, null, DB_VERSION);
	}
	
	
	@Override
	public void onCreate(SQLiteDatabase db) {
		final String CREATE_TABLE = "CREATE TABLE programmers (" 
				+ KEY_ID + "INTEGER PRIMARY KEY AUTOINCREMENT, "
				+ KEY_AGE + " INTEGER, " 
				+ KEY_NAME + "NVARCHAR(100)"
						+");";
		Log.i("Create DB123" , "CREATED");
		
		db.execSQL(CREATE_TABLE);
		//db.execSQL(sql, bindArgs);
	}
	@Override
	public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
		// TODO Auto-generated method stub
		db.execSQL("DROP TABLE IF EXISTS " + TABLE_NAME);
		onCreate(db);
	}
	
	public void addOne(Programmer p)
	{
		Log.d("addOne", "Inside addOne");
		
		SQLiteDatabase db = this.getWritableDatabase();
		Log.d("PUT ", "Before put");
		ContentValues values = new ContentValues();
	
		values.put(KEY_NAME, p.getName());
		values.put("_age", p.getAge());
		Log.d("PUT ", "Put done");

		db.insert(TABLE_NAME, null, values);
		db.close();
	}
	
	public Programmer get(int age)
	{
		SQLiteDatabase db = this.getReadableDatabase();
		
		Cursor c = db.rawQuery("SELECT * FROM " + TABLE_NAME, null);
		if (c != null)
			c.moveToFirst();
		
		int c1 = c.getColumnIndex(KEY_NAME);
		int c2 = c.getColumnIndex("_age");
		Programmer p = new Programmer(c.getInt(c2), c.getString(c1));
		
		return p;
	}
	
	private static final String KEY_ID = "id";
	private static final String KEY_NAME = "name";
	private static final String KEY_AGE = "age";
	private static final String DB_NAME = "db";
	private static final String TABLE_NAME = "programmers";
	private static final int DB_VERSION = 2;
} //DBHandler
